DROP TABLE IF EXISTS user_timer_group;
DROP TABLE IF EXISTS timer_timer_group;
DROP TABLE IF EXISTS timer;
DROP TABLE IF EXISTS timer_group;
DROP TABLE IF EXISTS cronograma;
DROP TABLE IF EXISTS user_account;

CREATE TABLE IF NOT EXISTS public.user_account
(
    user_account_id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name character varying(255) NOT NULL,
    email character varying(255) NOT NULL,
    password character varying(255) NOT NULL,
    PRIMARY KEY (user_account_id),
    UNIQUE (name),
    UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS public.timer_group
(
    timer_group_id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name character varying NOT NULL,
    PRIMARY KEY (timer_group_id)
);

CREATE TABLE IF NOT EXISTS public.timer
(
    timer_id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name character varying(255) NOT NULL,
    seconds integer NOT NULL,
    cronograma_id integer,
    PRIMARY KEY (timer_id)
);

CREATE TABLE IF NOT EXISTS public.cronograma
(
    cronograma_id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name character varying(255) NOT NULL,
    user_account_id integer NOT NULL,
    PRIMARY KEY (cronograma_id)
);

CREATE TABLE IF NOT EXISTS public.timer_timer_group
(
    timer_group_id integer NOT NULL,
    timer_id integer NOT NULL,
    PRIMARY KEY (timer_group_id, timer_id)
);

CREATE TABLE IF NOT EXISTS public.user_timer_group
(
    user_account_id integer NOT NULL,
    timer_group_id integer NOT NULL,
    PRIMARY KEY (user_account_id, timer_group_id)
);

ALTER TABLE IF EXISTS public.timer
    ADD FOREIGN KEY (cronograma_id)
    REFERENCES public.cronograma (cronograma_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.cronograma
    ADD FOREIGN KEY (user_account_id)
    REFERENCES public.user_account (user_account_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.timer_timer_group
    ADD FOREIGN KEY (timer_group_id)
    REFERENCES public.timer_group (timer_group_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.timer_timer_group
    ADD FOREIGN KEY (timer_id)
    REFERENCES public.timer (timer_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.user_timer_group
    ADD FOREIGN KEY (user_account_id)
    REFERENCES public.user_account (user_account_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.user_timer_group
    ADD FOREIGN KEY (timer_group_id)
    REFERENCES public.timer_group (timer_group_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;
    
INSERT INTO user_account (user_account_id, name, email, password)
VALUES
(1, 'Cucharoth', 'cucharoth@cucha.com', '$2b$12$IAHmqos7FFmVezNli6CD1eTu8vfW8Obkym9/Y4qUrzEFVv1qDTD8u'),
(2, 'Caramelo', 'caramelo@cucha.com', '$2b$12$IAHmqos7FFmVezNli6CD1eTu8vfW8Obkym9/Y4qUrzEFVv1qDTD8u')
ON CONFLICT DO NOTHING;

INSERT INTO timer_group (timer_group_id, name)
VALUES
(1,'ESP1'),
(2,'PRESENTACIÓN ISOFT')
ON CONFLICT DO NOTHING;

INSERT INTO cronograma (cronograma_id, name,user_account_id)
VALUES
(1,'PRESENTACIÓN ESP1', 1)
ON CONFLICT DO NOTHING;

INSERT INTO timer (timer_id, name, seconds, cronograma_id)
VALUES
(1, 'Intro', 5, 1),
(2, 'Objetivo', 5, 1),
(3, 'Tema1', 300, 1),
(4, 'Intro', 5, 1)
ON CONFLICT DO NOTHING;

INSERT INTO timer_timer_group (timer_id, timer_group_id)
VALUES
(1, 1),
(2, 1),
(3, 1),
(4, 1),
(1, 2)
ON CONFLICT DO NOTHING;
    
INSERT INTO user_timer_group (user_account_id, timer_group_id)
VALUES
(1, 1),
(2, 1),
(1, 2)
ON CONFLICT DO NOTHING;